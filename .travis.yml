os: linux
dist: bionic

stages:
  - verify_package
  - test

branches:
  only:
    - master

jobs:
  include:
    - stage: verify_package
      name: "verify debian package"
      script:
      - sudo ./gradlew assemble && sudo ./gradlew install
      - apt -f install
      - cd ./.travis/ && ./verify_debian-package.sh
    - stage: test
      name: "./test-curdir.sh"
      script:
      - sudo ./gradlew assemble && sudo ./gradlew install
      - cd ./.travis/ && ./test-curdir.sh
    - stage: test
      name: "./test-local-filepath.sh"
      script:
      - sudo ./gradlew assemble && sudo ./gradlew install
      - cd ./.travis/ && ./test-local-filepath.sh
    - stage: test
      name: "./test-filepath.sh"
      script:
      - sudo ./gradlew assemble && sudo ./gradlew install
      - cd ./.travis/ && ./test-filepath.sh
    - stage: test
      name: "./test-filedir.sh"
      script:
      - sudo ./gradlew assemble && sudo ./gradlew install
      - cd ./.travis/ && ./test-filedir.sh
    - stage: test
      name: "./test-stdin.sh"
      script:
      - sudo ./gradlew assemble && sudo ./gradlew install
      - cd ./.travis/ && ./test-stdin.sh
    - stage: test
      name: "./test-heredoc.sh"
      script:
      - sudo ./gradlew assemble && sudo ./gradlew install
      - cd ./.travis/ && ./test-heredoc.sh
    - stage: test
      name: "./test-fallback-curdir.sh"
      script:
      - sudo ./gradlew assemble && sudo ./gradlew install
      - cd ./.travis/ && ./test-fallback-curdir.sh

